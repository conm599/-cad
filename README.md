# CAD图像转换器与图片转线条图工具

一个基于Python的图像处理工具集，包含两个主要功能：CAD图像转DXF和图片转线条图。

## 功能特性

### 1. CAD图像转换器
- **阈值调整**：自定义图像二值化阈值
- **反色功能**：支持黑色背景处理
- **单线条模式**：使用骨架化算法提取单像素线条，优化显示效果
- **忽略边缘**：添加白色边框，分离主体内容和图像边框
- **高精度模式**：
  - 增加曲线数量：可选择8/16/32/48/64倍插值
  - 曲线边缘：使用样条曲线平滑轮廓
- **多图片布局工具**：独立页面，支持多图片上传、拖拽、排序和导出
- **实时预览**：处理前查看效果
- **DXF导出**：生成兼容CAD软件的DXF文件

### 2. 图片转线条图工具
- ✨ **多种边缘检测算法**：Canny、Sobel、Prewitt、Laplacian
- 🎨 **实时预览**：调整参数即时看到效果
- 📁 **批量处理**：支持文件夹批量导入和保存
- ⚙️ **参数可调**：灵活调节各种算法参数
- 💾 **多种输出格式**：支持 PNG、JPEG、BMP 等格式
- 🌓 **现代化界面**：基于 customtkinter 的暗色主题界面

## 安装方法
### 方式1：从源码运行

#### 安装依赖

```bash
pip install -r requirements.txt
```

#### 启动程序

1. **CAD图像转换器**：
   ```bash
   python main.py
   ```
   在浏览器中访问`http://127.0.0.1:5000`

2. **图片转线条图工具**：
   ```bash
   python tp/line_converter_app.py
   ```

### 重新打包

如果需要重新打包可执行文件：

```bash
# 打包CAD图像转换器
python build.py

# 打包图片转线条图工具
python tp/build_line_converter.py
```

## 使用说明

### CAD图像转换器

1. **上传图片**：点击"加载图片"按钮选择图片文件
2. **调整参数**：
   - 阈值：控制图像二值化的灵敏度
   - 反色：切换黑色/白色背景
   - 单线条模式：提取单像素线条
   - 忽略边缘：添加白色边框
   - 高精度模式：选择增加曲线数量或曲线边缘
3. **预览效果**：点击"更新预览"查看处理效果
4. **导出DXF**：点击"导出DXF"下载文件

#### 多图片布局工具

1. 在主页面点击"多图片布局工具"绿色按钮
2. 上传多张图片（可拖拽到页面）
3. 拖拽图片调整位置和顺序
4. 点击"导出图片"下载合成后的图片

### 图片转线条图工具

#### 单张图片处理

1. 点击"选择图片"按钮选择要处理的图片
2. 在左侧面板选择边缘检测算法
3. 调整参数（高斯模糊、阈值等）
4. 勾选"反转颜色"可反转黑白颜色
5. 点击"保存图片"保存处理结果

#### 批量处理

1. 切换到"批量模式"
2. 点击"选择文件夹"选择包含图片的文件夹
3. 调整算法和参数
4. 点击"保存图片"，选择输出文件夹
5. 程序会自动批量处理所有图片

## 算法说明

### 图片转线条图工具算法

#### Canny 边缘检测
最常用的边缘检测算法，流程是"灰度化→去噪→计算梯度→非极大值抑制→双阈值筛选"，能得到清晰、连续的边缘线段。

**参数**：
- 低阈值 (0-255)：边缘检测的弱阈值
- 高阈值 (0-255)：边缘检测的强阈值

#### Sobel 算子
通过计算图像像素的梯度变化（水平/垂直方向），提取边缘线段，优点是计算简单。

**参数**：
- 核大小 (1, 3, 5, 7)：卷积核大小，越大边缘越粗

#### Prewitt 算子
与 Sobel 类似的边缘检测算子，使用不同的卷积核。

**参数**：
- 核大小：固定为 3x3

#### Laplacian 算子
基于二阶导数的边缘检测，对噪声更敏感，但能检测出更细的边缘。

**参数**：
- 核大小 (1, 3, 5, 7)：卷积核大小

#### 通用参数

- **高斯模糊核大小**：用于去噪，减少噪声对边缘检测的影响

## 技术栈

### 共享技术栈
- **Python 3.11+**：开发语言
- **OpenCV**：图像处理
- **NumPy**：数值计算
- **PyInstaller**：EXE打包

### CAD图像转换器专用
- **Flask**：Web框架
- **scikit-image**：骨架化算法
- **scipy**：样条曲线插值
- **ezdxf**：DXF文件生成

### 图片转线条图工具专用
- **customtkinter**：现代化GUI界面
- **Pillow**：图像IO

## 项目结构

```
cad/
├── main.py                 # CAD图像转换器入口
├── build.py                # CAD转换器打包脚本
├── templates/              # Web界面模板
│   ├── index.html          # 主前端页面
│   └── multi_image.html    # 多图片布局工具
├── tp/                     # 图片转线条图工具目录
│   ├── line_converter_app.py   # 图片转线条图工具入口
│   ├── build_line_converter.py # 线条图工具打包脚本
│   ├── image_processor.py      # 核心图像处理模块
│   ├── gui.py                  # GUI界面模块
│   ├── batch_processor.py      # 批量处理模块
│   └── output/                 # 输出目录
├── requirements.txt        # 依赖包列表
├── venv/                   # 虚拟环境（可选）
├── README.md               # 项目说明
└── .gitignore              # Git忽略文件
```

## 许可证

MIT License

## 注意事项

### CAD图像转换器
- 支持的图像格式：JPG、PNG、BMP等
- 推荐使用分辨率适中的图片
- 单线条模式适合简单图形处理
- 忽略边缘功能有助于在CAD中编辑图像
- 高精度模式会增加DXF文件大小和处理时间
- 多图片布局工具导出的图片使用原始分辨率

### 图片转线条图工具
- 确保安装了所有依赖包
- 输入图片支持常见格式：JPG、PNG、BMP、TIFF、WebP
- 批量处理时，输出文件会自动添加 "_edges" 后缀

## 更新日志

### v1.1.0
- 新增多图片布局工具页面
- 新增单线条模式（使用scikit-image骨架化）
- 新增高精度模式（增加曲线数量/曲线边缘）
- 优化轮廓检测算法
- 更新依赖库（添加scikit-image、scipy）

### v1.0.0
- 初始版本发布
- 支持基本的图像转DXF功能
- 实现忽略边缘功能

